---
import { siteConfig } from "@/data/site.config";

type Position = (typeof siteConfig.experience)[number]["positions"][number];
type Company = (typeof siteConfig.experience)[number];
type Education = (typeof siteConfig.education)[number];

// Determine card size based on number of positions and tenure
function getCardSize(company: Company, index: number): "large" | "medium" | "small" {
  const posCount = company.positions.length;
  if (posCount >= 3 || index === 0) return "large";
  if (posCount >= 2) return "medium";
  return "small";
}

function getCardClasses(size: "large" | "medium" | "small"): string {
  const base = "group relative glass-surface rounded-xl border border-border transition-colors duration-300 animate-fade-in-up overflow-hidden hover:border-primary/50";
  if (size === "large") return `${base} md:col-span-2 lg:col-span-2`;
  if (size === "medium") return `${base} lg:row-span-2`;
  return base;
}
---

<div class="space-y-10">
  <!-- Education Row -->
  <div class="space-y-4">
    <div class="flex items-center gap-3">
      <div class="p-2 rounded-lg bg-primary/10">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-primary"
        >
          <path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z" />
          <path d="M22 10v6" />
          <path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5" />
        </svg>
      </div>
      <h3 class="text-2xl font-display font-semibold">Education</h3>
    </div>

    <div class="flex flex-wrap gap-4">
      {siteConfig.education.map((edu: Education, index: number) => (
        <div
          class="flex-1 min-w-[280px] glass-surface rounded-xl border border-border p-5 animate-fade-in-up hover:border-primary/50 transition-colors"
          style={`animation-delay: ${index * 100}ms; animation-fill-mode: backwards;`}
        >
          <div class="space-y-2">
            <div class="flex items-center gap-2 text-sm text-foreground/60">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
                <line x1="16" x2="16" y1="2" y2="6" />
                <line x1="8" x2="8" y1="2" y2="6" />
                <line x1="3" x2="21" y1="10" y2="10" />
              </svg>
              {edu.year}
            </div>
            <h4 class="font-semibold">{edu.title}</h4>
            {"focus" in edu && edu.focus && (
              <p class="text-sm text-foreground/60">Focus: {edu.focus}</p>
            )}
            {"honors" in edu && edu.honors && (
              <span class="inline-block px-2 py-0.5 text-xs font-medium bg-primary/10 text-primary rounded">
                {edu.honors}
              </span>
            )}
          </div>
        </div>
      ))}
    </div>
  </div>

  <!-- Work Bento Grid -->
  <div class="space-y-4">
    <div class="flex items-center gap-3">
      <div class="p-2 rounded-lg bg-primary/10">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-primary"
        >
          <rect width="20" height="14" x="2" y="7" rx="2" ry="2" />
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
        </svg>
      </div>
      <h3 class="text-2xl font-display font-semibold">Work Experience</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 auto-rows-min">
      {siteConfig.experience.map((company: Company, index: number) => {
        const size = getCardSize(company, index);
        const isCurrentRole = company.duration.includes("Present");

        return (
          <div
            class={getCardClasses(size)}
            style={`animation-delay: ${index * 80}ms; animation-fill-mode: backwards;`}
          >
            {/* Gradient overlay for large cards */}
            {size === "large" && (
              <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-accent/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
            )}

            <div class="relative p-6 h-full flex flex-col">
              {/* Header */}
              <div class="flex items-start justify-between gap-4 mb-4">
                <div class="space-y-1">
                  <div class="flex items-center gap-2">
                    {isCurrentRole && (
                      <span class="relative flex h-2.5 w-2.5">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-500 opacity-75" />
                        <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500" />
                      </span>
                    )}
                    <h4 class="font-bold text-lg">{company.company}</h4>
                  </div>
                  <div class="flex items-center gap-1.5 text-sm text-foreground/60">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                      <circle cx="12" cy="10" r="3" />
                    </svg>
                    {company.location}
                  </div>
                </div>
                <div class="text-right shrink-0">
                  <span class="px-3 py-1 text-xs font-semibold bg-secondary rounded-full">
                    {company.duration}
                  </span>
                  <p class="text-xs text-foreground/50 mt-1">
                    {company.positions.length} role{company.positions.length > 1 ? "s" : ""}
                  </p>
                </div>
              </div>

              {/* Position pills */}
              <div class="flex flex-wrap gap-2 mb-4">
                {company.positions.map((position: Position, pIndex: number) => (
                  <span
                    class={`px-3 py-1.5 text-sm rounded-lg ${
                      pIndex === 0
                        ? "bg-primary/10 text-primary font-medium"
                        : "bg-muted text-foreground/70"
                    }`}
                  >
                    {position.title}
                  </span>
                ))}
              </div>

              {/* All highlights visible */}
              <div class="flex-1">
                <div class="pt-4 border-t border-border/50 space-y-3">
                  {company.positions.flatMap((position: Position) =>
                    position.highlights.map((highlight: string) => (
                      <p
                        class="text-sm text-foreground/70 leading-relaxed flex gap-2"
                      >
                        <span class="text-primary shrink-0">&bull;</span>
                        {highlight}
                      </p>
                    ))
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      })}
    </div>
  </div>
</div>

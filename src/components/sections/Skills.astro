---
import { siteConfig } from "@/data/site.config";

type Skill = { name: string; category: string; proficiency: number };

// Group skills by category
const groupedSkills: Record<string, Skill[]> = {};
for (const skill of siteConfig.skills) {
  const category = skill.category;
  if (!(category in groupedSkills)) {
    groupedSkills[category] = [];
  }
  groupedSkills[category]!.push({ ...skill });
}

// Sort skills within each category by proficiency
for (const category of Object.keys(groupedSkills)) {
  groupedSkills[category]!.sort((a, b) => b.proficiency - a.proficiency);
}

const categories = Object.keys(groupedSkills);
---

<section id="skills" class="container mx-auto px-4 py-20">
  <div class="space-y-12">
    <div class="text-center space-y-4 section-header">
      <h2 class="text-4xl font-display font-bold">Skills</h2>
      <p class="text-foreground/60 max-w-2xl mx-auto">
        Technical proficiency across languages, frameworks, databases, and tools.
      </p>
    </div>

    <div class="space-y-6 max-w-5xl mx-auto">
      {categories.map((category, catIndex) => (
        <div class="space-y-3 skill-category" style={`animation-delay: ${catIndex * 0.1}s`}>
          <h3 class="text-base font-semibold text-foreground/80">{category}</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {groupedSkills[category]!.map((skill, skillIndex) => (
              <div
                class="flex items-center gap-3 skill-item"
                style={`animation-delay: ${catIndex * 0.1 + skillIndex * 0.05}s`}
              >
                <!-- Skill name -->
                <span class="text-sm font-medium text-foreground w-28 shrink-0">
                  {skill.name}
                </span>

                <!-- Progress bar -->
                <div class="flex-1 h-4 bg-muted rounded-full overflow-hidden">
                  <div
                    class="h-full bg-linear-to-r from-primary to-accent rounded-full skill-bar"
                    style={`--skill-proficiency: ${skill.proficiency}%; animation-delay: ${catIndex * 0.1 + skillIndex * 0.05}s`}
                  >
                  </div>
                </div>

                <!-- Proficiency label outside bar -->
                <span
                  class="text-xs font-semibold text-foreground/80 w-10 text-right shrink-0 skill-percentage"
                  style={`animation-delay: ${catIndex * 0.1 + skillIndex * 0.05 + 0.5}s`}
                >
                  {skill.proficiency}%
                </span>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  .section-header {
    opacity: 0;
    animation: fade-in-up 0.5s ease-out forwards;
  }

  .skill-category {
    opacity: 0;
    animation: fade-in-up 0.5s ease-out forwards;
  }

  .skill-item {
    opacity: 0;
    animation: slide-in 0.4s ease-out forwards;
  }

  .skill-bar {
    width: 0;
    animation: skill-bar-grow 1s ease-out forwards;
  }

  .skill-percentage {
    opacity: 0;
    animation: fade-in 0.3s ease-out forwards;
  }

  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slide-in {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes skill-bar-grow {
    from {
      width: 0;
    }
    to {
      width: var(--skill-proficiency);
    }
  }

  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .section-header,
    .skill-category,
    .skill-item,
    .skill-bar,
    .skill-percentage {
      animation: none;
      opacity: 1;
      transform: none;
      width: var(--skill-proficiency);
    }
  }
</style>

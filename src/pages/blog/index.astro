---
import { getCollection } from "astro:content";
import BlogLayout from "@/layouts/BlogLayout.astro";
import { formatDate } from "@/lib/utils";

// Get all blog posts from content collections
const allPosts = await getCollection("blog");

// Filter published posts and sort by date (newest first)
const posts = allPosts
  .filter((post) => post.data.published === true)
  .sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
  );

// Calculate reading time (200 words per minute)
function calculateReadingTime(content: string): string {
  const wordsPerMinute = 200;
  const words = content.trim().split(/\s+/).length;
  const minutes = Math.ceil(words / wordsPerMinute);
  return `${minutes} min read`;
}
---

<BlogLayout
  title="Blog"
  description="Thoughts on software development, technology, and building products."
>
  <div class="container mx-auto px-4 py-20">
    <div class="max-w-4xl mx-auto space-y-12">
      <div class="space-y-4">
        <h1 class="text-5xl font-display font-bold">Blog</h1>
        <p class="text-xl text-foreground/70">
          Thoughts on software development, technology, and building products.
        </p>
      </div>

      {posts.length === 0 ? (
        <p class="text-foreground/60">No posts yet. Check back soon!</p>
      ) : (
        <div class="space-y-6">
          {posts.map((post) => {
            const readingTime = calculateReadingTime(post.body);
            return (
              <a
                href={`/blog/${post.slug}`}
                class="block transition-all hover:scale-[1.01]"
              >
                <article class="glass-surface hover:border-primary/50 transition-colors rounded-lg overflow-hidden border border-border/40">
                  <div class="p-6 space-y-4">
                    <div class="flex items-center justify-between gap-4 flex-wrap">
                      <span class="text-sm px-3 py-1 bg-secondary text-secondary-foreground rounded">
                        {readingTime}
                      </span>
                      <time
                        datetime={post.data.date}
                        class="text-sm text-foreground/60"
                      >
                        {formatDate(post.data.date)}
                      </time>
                    </div>
                    <h2 class="text-2xl font-bold hover:text-primary transition-colors">
                      {post.data.title}
                    </h2>
                    {post.data.excerpt && (
                      <p class="text-base text-foreground/70">
                        {post.data.excerpt}
                      </p>
                    )}
                    {post.data.tags && post.data.tags.length > 0 && (
                      <div class="flex flex-wrap gap-2">
                        {post.data.tags.map((tag) => (
                          <span class="text-xs px-2 py-1 border border-border/60 rounded">
                            {tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </article>
              </a>
            );
          })}
        </div>
      )}
    </div>
  </div>
</BlogLayout>
